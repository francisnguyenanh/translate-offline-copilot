<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel & PowerPoint Translation Manager</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome cho icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .function-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            height: 100%;
            transition: transform 0.3s;
        }
        
        .function-card:hover {
            transform: translateY(-5px);
        }
        
        .function-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1.3rem;
        }
        
        .function-card .icon {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 8px;
        }
        
        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            background: #f8f9fa;
            margin: 15px 0;
            transition: all 0.3s;
        }
        
        .upload-area.compact {
            padding: 15px;
            margin: 10px 0;
        }
        
        .upload-area:hover {
            background: #e9ecef;
            border-color: #764ba2;
        }
        
        .upload-area i {
            font-size: 1.5rem;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .collapse-toggle {
            cursor: pointer;
            user-select: none;
        }
        
        .collapse-toggle:hover {
            opacity: 0.8;
        }
        
        .btn-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-custom:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            color: white;
        }
        
        .alert-custom {
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .file-info {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .loading {
            display: none;
            margin-top: 15px;
        }
        
        .loading .spinner-border {
            width: 2rem;
            height: 2rem;
        }
        
        .json-file-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 10px;
            background: #f0f7ff;
            border: 1px solid #cce0ff;
            border-radius: 6px;
            margin-bottom: 6px;
            gap: 8px;
        }
        
        .json-file-row .file-name {
            font-size: 0.78rem;
            color: #333;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .json-file-row .btn-copy-json {
            flex-shrink: 0;
            font-size: 0.75rem;
            padding: 3px 10px;
        }
        
        .btn-copy-json.copied {
            background-color: #28a745 !important;
            border-color: #28a745 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-language"></i> Tomo Translation</h1>
            <p>C√¥ng c·ª• qu·∫£n l√Ω tr√≠ch xu·∫•t v√† n·∫°p b·∫£n d·ªãch cho file Excel (.xlsx), PowerPoint (.pptx) v√† Word (.docx)</p>
            <div class="mt-3">
                <button class="btn btn-outline-light btn-sm" onclick="clearUploads()" title="X√≥a file trong phi√™n c·ªßa b·∫°n">
                    <i class="fas fa-trash-alt"></i> X√≥a file c·ªßa t√¥i
                </button>
                <a href="/logout" class="btn btn-outline-light btn-sm ms-2" title="ƒêƒÉng xu·∫•t">
                    <i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t
                </a>
            </div>
        </div>
        
        <!-- 3 B∆∞·ªõc theo h√†ng ngang -->
        <div class="row g-3">
            <!-- B∆∞·ªõc 1: Upload file -->
            <div class="col-lg-4">
                <div class="function-card">
                    <div class="text-center">
                        <span class="step-number">1</span>
                        <h3 class="d-inline">Upload File</h3>
                        <p class="text-muted small mt-2">File g·ªëc (.xlsx/.pptx/.docx)</p>
                    </div>
                    
                    <form id="uploadExcelForm" enctype="multipart/form-data">
                        <div class="upload-area compact" id="mainUploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p class="mb-2 small"><strong>K√©o th·∫£ file v√†o ƒë√¢y</strong></p>
                            <input type="file" class="form-control" id="mainExcelFile" name="file" accept=".xlsx,.pptx" style="display: none;">
                            <label for="mainExcelFile" class="btn btn-custom btn-sm">
                                <i class="fas fa-folder-open"></i> Ch·ªçn file
                            </label>
                        </div>
                        
                        <div id="mainFileInfo" class="file-info" style="display: none;">
                            <i id="mainFileIcon" class="fas fa-file text-secondary"></i>
                            <span id="mainFileName" class="small"></span>
                            <button type="button" class="btn btn-sm btn-outline-danger float-end" id="mainFileRemove">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div id="mainAlert"></div>
                    </form>

                    <!-- Ch·ªçn ng√¥n ng·ªØ ƒë√≠ch -->
                    <div class="mt-3">
                        <label for="targetLangSelect" class="form-label small mb-1">
                            <i class="fas fa-globe"></i> <strong>Ng√¥n ng·ªØ ƒë√≠ch:</strong>
                        </label>
                        <select class="form-select form-select-sm" id="targetLangSelect">
                            <option value="" disabled>ƒêang t·∫£i danh s√°ch...</option>
                        </select>
                        <div class="text-muted" style="font-size: 0.72rem; margin-top: 4px;">
                            <i class="fas fa-info-circle"></i> Danh s√°ch ng√¥n ng·ªØ ch·ªânh s·ª≠a trong <code>languages.json</code>
                        </div>
                    </div>
                    
                    <!-- H∆∞·ªõng d·∫´n collapse -->
                    <div class="mt-3">
                        <div class="collapse-toggle p-2" style="background: #f8f9fa; border-radius: 5px;" data-bs-toggle="collapse" data-bs-target="#step1Guide">
                            <i class="fas fa-info-circle text-info"></i>
                            <small><strong>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</strong></small>
                            <i class="fas fa-chevron-down float-end"></i>
                        </div>
                        <div class="collapse mt-2" id="step1Guide">
                            <div class="p-2" style="background: #f8f9fa; border-radius: 5px;">
                                <ul class="small mb-0" style="padding-left: 20px;">
                                    <li>H·ªó tr·ª£ Excel (.xlsx), PowerPoint (.pptx) <b>v√† Word (.docx)</b></li>
                                    <li>K√©o th·∫£ ho·∫∑c click ƒë·ªÉ ch·ªçn file</li>
                                    <li>File s·∫Ω d√πng cho c·∫£ Extract v√† Inject</li>
                                    <li>Gi·ªõi h·∫°n: 16MB</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- B∆∞·ªõc 2: Extract -->
            <div class="col-lg-4">
                <div class="function-card">
                    <div class="text-center">
                        <span class="step-number">2</span>
                        <h3 class="d-inline">Tr√≠ch xu·∫•t</h3>
                        <p class="text-muted small mt-2">Extract n·ªôi dung c·∫ßn d·ªãch</p>
                    </div>
                    
                    <form id="extractForm" enctype="multipart/form-data">
                        <div class="text-center mt-3">
                            <button type="submit" class="btn btn-custom btn-sm" id="extractBtn" disabled>
                                <i class="fas fa-cog"></i> Tr√≠ch xu·∫•t JSON
                            </button>
                        </div>
                        
                        <div class="loading text-center" id="extractLoading">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">ƒêang x·ª≠ l√Ω...</span>
                            </div>
                            <p class="mt-2 small">ƒêang tr√≠ch xu·∫•t d·ªØ li·ªáu...</p>
                        </div>
                        
                        <div id="extractAlert"></div>
                    </form>
                    
                    <!-- K·∫øt qu·∫£ sau khi tr√≠ch xu·∫•t -->
                    <div id="extractResult" style="display: none;">
                        <hr class="my-2">
                        
                        <!-- Btn download ZIP -->
                        <div class="text-center mb-2">
                            <a id="downloadZipBtn" href="/download-zip" class="btn btn-success btn-sm">
                                <i class="fas fa-file-archive"></i> T·∫£i ZIP
                            </a>
                            <span id="extractSummary" class="text-muted small ms-2"></span>
                        </div>
                        
                        <!-- Danh s√°ch file JSON -->
                        <div id="jsonFileList"></div>
                    </div>
                    
                    <!-- Prompt AI -->
                    <div class="mt-3 text-center">
                        <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="collapse" data-bs-target="#promptDetail">
                            <i class="fas fa-eye"></i> Xem Prompt AI
                        </button>
                    </div>
                    
                    <!-- N·ªôi dung prompt collapse -->
                    <div class="collapse mt-2" id="promptDetail">
                        <div style="background: #e3f2fd; padding: 10px; border-radius: 5px; border: 1px solid #90caf9;">
                            <pre id="aiPrompt" style="margin: 0; font-size: 0.7rem; white-space: pre-wrap; word-wrap: break-word; max-height: 200px; overflow-y: auto;">H√£y d·ªãch c√°c gi√° tr·ªã (values) trong file JSON n√†y sang {TARGET_LANG}.

Quy t·∫Øc b·∫Øt bu·ªôc:
1. Gi·ªØ nguy√™n 100% c√°c keys (t·ªça ƒë·ªô cell nh∆∞ "Sheet1!A1")
2. CH·ªà d·ªãch n·ªôi dung b√™n trong values
3. KH√îNG d·ªãch c√°c t·ª´/c·ª•m t·ª´ ƒë√£ l√† ng√¥n ng·ªØ ƒë√≠ch - GI·ªÆ NGUY√äN ch√∫ng
4. KH√îNG d·ªãch c√°c m√£ k·ªπ thu·∫≠t, placeholder, ho·∫∑c t√™n bi·∫øn
5. KH√îNG d·ªãch s·ªë, ng√†y th√°ng, k√Ω hi·ªáu ƒë·∫∑c bi·ªát
6. Gi·ªØ nguy√™n format JSON chu·∫©n

‚ö†Ô∏è QUY T·∫ÆC QUAN TR·ªåNG v·ªÅ d·∫•u ngo·∫∑c k√©p:
- CH·ªà s·ª≠ d·ª•ng d·∫•u ngo·∫∑c k√©p TH·∫≤NG chu·∫©n JSON: " (U+0022)
- TUY·ªÜT ƒê·ªêI KH√îNG d√πng d·∫•u ngo·∫∑c k√©p ƒë·∫∑c bi·ªát: " " ‚Äû ‚Äü ¬´ ¬ª
- N·∫øu c·∫ßn tr√≠ch d·∫´n trong n·ªôi dung d·ªãch: d√πng „Äå „Äçho·∫∑c 'ƒë∆°n'
- V√≠ d·ª• ƒê√öNG: "App „ÄåOrder Printer Pro„Äç „ÅÆ‰ΩøÁî®"
- V√≠ d·ª• SAI: "App "Order Printer Pro" „ÅÆ‰ΩøÁî®" ‚ùå

Output y√™u c·∫ßu:
- Tr·∫£ v·ªÅ ƒê√öNG c·∫•u tr√∫c JSON g·ªëc
- KH√îNG th√™m gi·∫£i th√≠ch hay vƒÉn b·∫£n n√†o kh√°c
- ƒê·∫£m b·∫£o encoding UTF-8
- Ki·ªÉm tra k·ªπ KH√îNG c√≥ d·∫•u ngo·∫∑c k√©p ƒë·∫∑c bi·ªát trong output</pre>
                        </div>
                    </div>
                    
                    <!-- H∆∞·ªõng d·∫´n collapse -->
                    <div class="mt-3">
                        <div class="collapse-toggle p-2" style="background: #f8f9fa; border-radius: 5px;" data-bs-toggle="collapse" data-bs-target="#step2Guide">
                            <i class="fas fa-info-circle text-info"></i>
                            <small><strong>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</strong></small>
                            <i class="fas fa-chevron-down float-end"></i>
                        </div>
                        <div class="collapse mt-2" id="step2Guide">
                            <div class="p-2" style="background: #f8f9fa; border-radius: 5px;">
                                <ul class="small mb-0" style="padding-left: 20px;">
                                    <li>Click "Tr√≠ch xu·∫•t JSON" ƒë·ªÉ x·ª≠ l√Ω</li>
                                    <li>Sau khi xong: hi·ªÉn th·ªã t·ª´ng file JSON</li>
                                    <li>Click <strong>Copy</strong> ƒë·ªÉ copy prompt + JSON ‚Üí paste v√†o AI</li>
                                    <li>Click <strong>T·∫£i ZIP</strong> ƒë·ªÉ t·∫£i t·∫•t c·∫£ file</li>
                                    <li>Excel: B·ªè qua s·ªë v√† c√¥ng th·ª©c</li>
                                    <li>PowerPoint: Tr√≠ch xu·∫•t text t·ª´ shapes</li>
                                    <li>Word: Tr√≠ch xu·∫•t text t·ª´ paragraphs, b·∫£ng, header/footer</li>
                                    <li>M·ªói file JSON ch·ª©a 400 c·∫∑p key-value</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- B∆∞·ªõc 3: Inject -->
            <div class="col-lg-4">
                <div class="function-card">
                    <div class="text-center">
                        <span class="step-number">3</span>
                        <h3 class="d-inline">N·∫°p b·∫£n d·ªãch</h3>
                        <p class="text-muted small mt-2">Inject JSON ƒë√£ d·ªãch v√†o file</p>
                    </div>
                    
                    <form id="injectForm" enctype="multipart/form-data">
                        <!-- Tab ch·ªçn gi·ªØa Upload file v√† Paste JSON -->
                        <ul class="nav nav-tabs nav-fill mb-2" id="injectTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="upload-tab" data-bs-toggle="tab" data-bs-target="#uploadTab" type="button" role="tab">
                                    <i class="fas fa-folder-open"></i> Upload File
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="paste-tab" data-bs-toggle="tab" data-bs-target="#pasteTab" type="button" role="tab">
                                    <i class="fas fa-paste"></i> Paste JSON
                                </button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="injectTabContent">
                            <!-- Tab Upload File -->
                            <div class="tab-pane fade" id="uploadTab" role="tabpanel">
                                <div class="upload-area compact" id="injectJsonUploadArea">
                                    <i class="fas fa-file-code"></i>
                                    <p class="mb-2 small"><strong>K√©o th·∫£ JSON/ZIP</strong></p>
                                    <input type="file" class="form-control" id="injectJsonFile" name="json_files" accept=".json,.zip" multiple style="display: none;">
                                    <label for="injectJsonFile" class="btn btn-custom btn-sm">
                                        <i class="fas fa-folder-open"></i> Ch·ªçn file
                                    </label>
                                </div>
                                
                                <div id="injectJsonFileInfo" class="file-info" style="display: none;">
                                    <div id="injectJsonFileList"></div>
                                    <button type="button" class="btn btn-sm btn-outline-danger float-end mt-2" id="injectJsonFileRemove">
                                        <i class="fas fa-times"></i> X√≥a t·∫•t c·∫£
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Tab Paste JSON -->
                            <div class="tab-pane fade show active" id="pasteTab" role="tabpanel">
                                <div class="mb-2">
                                    <label class="form-label small mb-1"><strong>Paste n·ªôi dung JSON:</strong></label>
                                    <textarea class="form-control" id="pasteJsonTextarea" rows="5" placeholder='Paste n·ªôi dung JSON v√†o ƒë√¢y, v√≠ d·ª•:
{
  "Sheet1!A1": "Translated text 1",
  "Sheet1!A2": "Translated text 2"
}' style="font-family: monospace; font-size: 0.85rem;"></textarea>
                                </div>
                                <div class="text-center mb-2">
                                    <button type="button" class="btn btn-outline-primary btn-sm" id="addPastedJsonBtn">
                                        <i class="fas fa-plus-circle"></i> Th√™m JSON n√†y
                                    </button>
                                </div>
                                
                                <!-- Danh s√°ch JSON ƒë√£ paste -->
                                <div id="pastedJsonList" style="display: none;">
                                    <div class="file-info">
                                        <label class="form-label small mb-1"><strong>ƒê√£ th√™m:</strong></label>
                                        <div id="pastedJsonItems"></div>
                                        <button type="button" class="btn btn-sm btn-outline-danger mt-2" id="clearPastedJsonBtn">
                                            <i class="fas fa-trash"></i> X√≥a t·∫•t c·∫£
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-2">
                            <button type="submit" class="btn btn-custom btn-sm" id="injectBtn" disabled>
                                <i class="fas fa-download"></i> N·∫°p & T·∫£i v·ªÅ
                            </button>
                        </div>
                        
                        <div class="loading text-center" id="injectLoading">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">ƒêang x·ª≠ l√Ω...</span>
                            </div>
                            <p class="mt-2 small">ƒêang n·∫°p b·∫£n d·ªãch...</p>
                        </div>
                        
                        <div id="injectAlert"></div>
                    </form>
                    
                    <!-- H∆∞·ªõng d·∫´n collapse -->
                    <div class="mt-3">
                        <div class="collapse-toggle p-2" style="background: #f8f9fa; border-radius: 5px;" data-bs-toggle="collapse" data-bs-target="#step3Guide">
                            <i class="fas fa-info-circle text-info"></i>
                            <small><strong>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</strong></small>
                            <i class="fas fa-chevron-down float-end"></i>
                        </div>
                        <div class="collapse mt-2" id="step3Guide">
                            <div class="p-2" style="background: #f8f9fa; border-radius: 5px;">
                                <ul class="small mb-0" style="padding-left: 20px;">
                                    <li><strong>2 c√°ch n·∫°p JSON:</strong></li>
                                    <li style="list-style: none; padding-left: 15px;">
                                        ‚Ä¢ <strong>Upload file:</strong> Ch·ªçn file JSON/ZIP (h·ªó tr·ª£ nhi·ªÅu file c√πng l√∫c)
                                    </li>
                                    <li style="list-style: none; padding-left: 15px;">
                                        ‚Ä¢ <strong>Paste JSON:</strong> Paste tr·ª±c ti·∫øp n·ªôi dung JSON (c√≥ th·ªÉ paste nhi·ªÅu l·∫ßn)
                                    </li>
                                    <li>T·ª± ƒë·ªông g·ªôp v√† n·∫°p v√†o file g·ªëc (Excel, PowerPoint <b>ho·∫∑c Word</b>)</li>
                                    <li>Gi·ªØ nguy√™n ƒë·ªãnh d·∫°ng, m√†u s·∫Øc, b·∫£ng, header/footer cho Word</li>
                                    <li>T·∫£i v·ªÅ file output_translated</li>
                                    <li>File t·∫°m t·ª± ƒë·ªông x√≥a sau khi t·∫£i</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="text-center mt-5" style="color: #fff; opacity: 0.85;">
        <hr style="border-color: #fff; opacity: 0.2;">
        <div class="pb-2">
            <small>
                &copy; 2026 Tomo Translation &middot; Built by <a href="mailto:eikitomobe@gmail.com" style="color: #fff; text-decoration: underline;">ÂèãÈÉ® ÁëõÁ®Ä</a>
            </small>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ==================== BI·∫æN TO√ÄN C·ª§C ====================
        let uploadedExcelFilename = null; // L∆∞u t√™n file Excel ƒë√£ upload

        // ==================== NG√îN NG·ªÆ ƒê√çCH ====================
        // Template prompt (d√πng {TARGET_LANG} l√†m placeholder)
        const PROMPT_TEMPLATE = document.getElementById('aiPrompt').textContent;

        function updatePrompt(langName) {
            document.getElementById('aiPrompt').textContent =
                PROMPT_TEMPLATE.replace('{TARGET_LANG}', langName);
        }

        async function loadLanguages() {
            const select = document.getElementById('targetLangSelect');
            try {
                const res = await fetch('/api/languages');
                if (!res.ok) throw new Error('HTTP ' + res.status);
                const langs = await res.json();

                select.innerHTML = '';
                langs.forEach(function(lang) {
                    const opt = document.createElement('option');
                    opt.value = lang.code;
                    opt.textContent = lang.label;
                    opt.dataset.name = lang.name;
                    // M·∫∑c ƒë·ªãnh ch·ªçn ti·∫øng Nh·∫≠t
                    if (lang.code === 'ja') opt.selected = true;
                    select.appendChild(opt);
                });

                // C·∫≠p nh·∫≠t prompt v·ªõi ng√¥n ng·ªØ m·∫∑c ƒë·ªãnh
                const defaultOpt = select.options[select.selectedIndex];
                if (defaultOpt) updatePrompt(defaultOpt.dataset.name);

            } catch (e) {
                select.innerHTML = '<option value="ja" data-name="ti·∫øng Nh·∫≠t">üáØüáµ Ti·∫øng Nh·∫≠t (Japanese)</option>';
                updatePrompt('ti·∫øng Nh·∫≠t');
                console.warn('Kh√¥ng th·ªÉ t·∫£i languages.json:', e);
            }

            // C·∫≠p nh·∫≠t prompt khi user ƒë·ªïi ng√¥n ng·ªØ
            select.addEventListener('change', function() {
                const chosen = this.options[this.selectedIndex];
                if (chosen) updatePrompt(chosen.dataset.name);
            });
        }

        // Ch·∫°y ngay khi trang load
        loadLanguages();

        // ==================== UPLOAD EXCEL CHUNG ====================
        const mainExcelFile = document.getElementById('mainExcelFile');
        const mainFileInfo = document.getElementById('mainFileInfo');
        const mainFileName = document.getElementById('mainFileName');
        const mainFileRemove = document.getElementById('mainFileRemove');
        const mainAlert = document.getElementById('mainAlert');
        const mainUploadArea = document.getElementById('mainUploadArea');
        const extractBtn = document.getElementById('extractBtn');
        const injectBtn = document.getElementById('injectBtn');
        
        // X·ª≠ l√Ω khi ch·ªçn file Excel chung
        mainExcelFile.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                mainFileName.textContent = file.name;
                mainFileInfo.style.display = 'block';
                uploadedExcelFilename = file.name;
                
                // Thay ƒë·ªïi icon ph√π h·ª£p v·ªõi lo·∫°i file
                const fileIcon = document.getElementById('mainFileIcon');
                const fileName = file.name.toLowerCase();
                
                if (fileName.endsWith('.xlsx')) {
                    fileIcon.className = 'fas fa-file-excel text-success';
                } else if (fileName.endsWith('.pptx')) {
                    fileIcon.className = 'fas fa-file-powerpoint text-danger';
                } else if (fileName.endsWith('.docx')) {
                    fileIcon.className = 'fas fa-file-word text-primary';
                } else {
                    fileIcon.className = 'fas fa-file text-secondary';
                }
                
                // K√≠ch ho·∫°t c·∫£ 2 n√∫t Extract v√† Inject
                extractBtn.disabled = false;
                injectBtn.disabled = false;
                
                // Hi·ªÉn th·ªã th√¥ng b√°o
                showAlert(mainAlert, 'success', `File "${file.name}" ƒë√£ ƒë∆∞·ª£c ch·ªçn. B·∫°n c√≥ th·ªÉ ti·∫øn h√†nh Extract ho·∫∑c Inject.`);
            }
        });
        
        // X·ª≠ l√Ω x√≥a file
        mainFileRemove.addEventListener('click', function() {
            mainExcelFile.value = '';
            mainFileInfo.style.display = 'none';
            uploadedExcelFilename = null;
            extractBtn.disabled = true;
            injectBtn.disabled = true;
            mainAlert.innerHTML = '';
        });
        
        // X·ª≠ l√Ω drag and drop
        mainUploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            mainUploadArea.style.borderColor = '#764ba2';
            mainUploadArea.style.background = '#e9ecef';
        });
        
        mainUploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            mainUploadArea.style.borderColor = '#667eea';
            mainUploadArea.style.background = '#f8f9fa';
        });
        
        mainUploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            mainUploadArea.style.borderColor = '#667eea';
            mainUploadArea.style.background = '#f8f9fa';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                mainExcelFile.files = files;
                mainFileName.textContent = files[0].name;
                mainFileInfo.style.display = 'block';
                uploadedExcelFilename = files[0].name;
                extractBtn.disabled = false;
                injectBtn.disabled = false;
                showAlert(mainAlert, 'success', `File "${files[0].name}" ƒë√£ ƒë∆∞·ª£c ch·ªçn.`);
            }
        });
        
        // ==================== CH·ª®C NƒÇNG EXTRACT ====================
        
        const extractForm = document.getElementById('extractForm');
        const extractAlert = document.getElementById('extractAlert');
        const extractLoading = document.getElementById('extractLoading');
        const extractResult = document.getElementById('extractResult');
        const extractSummary = document.getElementById('extractSummary');
        const jsonFileList = document.getElementById('jsonFileList');
        
        // X·ª≠ l√Ω submit form Extract
        extractForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Ki·ªÉm tra xem c√≥ file ƒë∆∞·ª£c upload ch∆∞a
            if (!uploadedExcelFilename || mainExcelFile.files.length === 0) {
                showAlert(extractAlert, 'warning', 'Vui l√≤ng upload file (Excel ho·∫∑c PowerPoint) ·ªü B∆∞·ªõc 1 tr∆∞·ªõc!');
                return;
            }
            
            // ·∫®n k·∫øt qu·∫£ c≈©
            extractResult.style.display = 'none';
            jsonFileList.innerHTML = '';
            
            // Hi·ªÉn th·ªã loading
            extractLoading.style.display = 'block';
            extractAlert.innerHTML = '';
            
            // T·∫°o FormData v·ªõi file Excel t·ª´ upload chung
            const formData = new FormData();
            formData.append('file', mainExcelFile.files[0]);
            
            try {
                // G·ª≠i request
                const response = await fetch('/extract', {
                    method: 'POST',
                    body: formData
                });
                
                // ·∫®n loading
                extractLoading.style.display = 'none';
                
                // Ki·ªÉm tra content-type
                const contentType = response.headers.get('content-type');
                
                if (response.ok && contentType && contentType.includes('application/json')) {
                    const data = await response.json();
                    
                    if (data.success) {
                        // Hi·ªÉn th·ªã t√≥m t·∫Øt
                        extractSummary.textContent = `${data.total_files} file ¬∑ ${data.total_items} keys`;
                        
                        // Render t·ª´ng h√†ng file JSON
                        renderJsonFileRows(data.files);
                        
                        // Hi·ªán khu v·ª±c k·∫øt qu·∫£
                        extractResult.style.display = 'block';
                        
                        showAlert(extractAlert, 'success', `Tr√≠ch xu·∫•t th√†nh c√¥ng! ${data.total_files} file JSON, ${data.total_items} c·∫∑p key-value. Click <strong>Copy</strong> ƒë·ªÉ copy prompt + JSON v√†o AI, ho·∫∑c <strong>T·∫£i ZIP</strong> ƒë·ªÉ t·∫£i t·∫•t c·∫£.`);
                    } else {
                        showAlert(extractAlert, 'danger', data.error || 'C√≥ l·ªói x·∫£y ra!');
                    }
                } else if (!response.ok) {
                    if (contentType && contentType.includes('application/json')) {
                        const error = await response.json();
                        showAlert(extractAlert, 'danger', error.error || 'C√≥ l·ªói x·∫£y ra!');
                    } else {
                        const text = await response.text();
                        if (text.includes('<html') || text.includes('<!DOCTYPE')) {
                            showAlert(extractAlert, 'danger', 'Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n. Vui l√≤ng <a href="/login">ƒëƒÉng nh·∫≠p l·∫°i</a>.');
                        } else {
                            showAlert(extractAlert, 'danger', 'L·ªói: ' + (text || 'Kh√¥ng x√°c ƒë·ªãnh'));
                        }
                    }
                }
            } catch (error) {
                extractLoading.style.display = 'none';
                showAlert(extractAlert, 'danger', 'L·ªói k·∫øt n·ªëi: ' + error.message);
            }
        });
        
        // Render danh s√°ch file JSON th√†nh t·ª´ng h√†ng
        function renderJsonFileRows(files) {
            jsonFileList.innerHTML = '';
            
            files.forEach(function(file, idx) {
                const row = document.createElement('div');
                row.className = 'json-file-row';
                row.innerHTML = `
                    <span class="file-name" title="${file.name}">
                        <i class="fas fa-file-code text-primary"></i>
                        ${file.name}
                    </span>
                    <button type="button"
                        class="btn btn-outline-primary btn-sm btn-copy-json"
                        data-idx="${idx}"
                        title="Copy prompt AI + n·ªôi dung JSON n√†y">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                `;
                
                // L∆∞u n·ªôi dung v√†o data attribute (d√πng dataset)
                row.querySelector('.btn-copy-json').addEventListener('click', function() {
                    const btnEl = this;
                    // ƒê·ªçc prompt t·∫°i th·ªùi ƒëi·ªÉm click ƒë·ªÉ lu√¥n d√πng ng√¥n ng·ªØ hi·ªán t·∫°i
                    const promptText = document.getElementById('aiPrompt').textContent;
                    const textToCopy = promptText + '\n\n' + file.content;
                    
                    navigator.clipboard.writeText(textToCopy).then(function() {
                        btnEl.innerHTML = '<i class="fas fa-check"></i> Copied!';
                        btnEl.classList.add('copied');
                        setTimeout(function() {
                            btnEl.innerHTML = '<i class="fas fa-copy"></i> Copy';
                            btnEl.classList.remove('copied');
                        }, 2000);
                    }).catch(function() {
                        // Fallback cho browser kh√¥ng h·ªó tr·ª£ clipboard API
                        const textarea = document.createElement('textarea');
                        textarea.value = textToCopy;
                        textarea.style.position = 'fixed';
                        textarea.style.opacity = '0';
                        document.body.appendChild(textarea);
                        textarea.select();
                        try {
                            document.execCommand('copy');
                            btnEl.innerHTML = '<i class="fas fa-check"></i> Copied!';
                            btnEl.classList.add('copied');
                            setTimeout(function() {
                                btnEl.innerHTML = '<i class="fas fa-copy"></i> Copy';
                                btnEl.classList.remove('copied');
                            }, 2000);
                        } catch(err) {
                            alert('Kh√¥ng th·ªÉ copy t·ª± ƒë·ªông. Vui l√≤ng copy th·ªß c√¥ng.');
                        }
                        document.body.removeChild(textarea);
                    });
                });
                
                jsonFileList.appendChild(row);
            });
        }
        
        // ==================== CH·ª®C NƒÇNG INJECT ====================
        
        const injectForm = document.getElementById('injectForm');
        const injectJsonFile = document.getElementById('injectJsonFile');
        const injectJsonFileInfo = document.getElementById('injectJsonFileInfo');
        const injectJsonFileName = document.getElementById('injectJsonFileName');
        const injectJsonFileRemove = document.getElementById('injectJsonFileRemove');
        const injectAlert = document.getElementById('injectAlert');
        const injectLoading = document.getElementById('injectLoading');
        
        // Paste JSON functionality
        const pasteJsonTextarea = document.getElementById('pasteJsonTextarea');
        const addPastedJsonBtn = document.getElementById('addPastedJsonBtn');
        const pastedJsonList = document.getElementById('pastedJsonList');
        const pastedJsonItems = document.getElementById('pastedJsonItems');
        const clearPastedJsonBtn = document.getElementById('clearPastedJsonBtn');
        
        // L∆∞u danh s√°ch JSON ƒë√£ paste
        let pastedJsonData = [];
        
        // X·ª≠ l√Ω khi click "Th√™m JSON n√†y"
        addPastedJsonBtn.addEventListener('click', function() {
            const jsonText = pasteJsonTextarea.value.trim();
            
            if (!jsonText) {
                showAlert(injectAlert, 'warning', 'Vui l√≤ng paste n·ªôi dung JSON v√†o √¥ b√™n tr√™n!');
                return;
            }
            
            // Validate JSON
            try {
                const parsedJson = JSON.parse(jsonText);
                
                // Ki·ªÉm tra xem c√≥ ph·∫£i object kh√¥ng
                if (typeof parsedJson !== 'object' || parsedJson === null) {
                    showAlert(injectAlert, 'warning', 'JSON ph·∫£i l√† m·ªôt object (kh√¥ng ph·∫£i array ho·∫∑c gi√° tr·ªã ƒë∆°n)!');
                    return;
                }
                
                // Th√™m v√†o danh s√°ch
                pastedJsonData.push(parsedJson);
                
                // Hi·ªÉn th·ªã trong danh s√°ch
                updatePastedJsonList();
                
                // X√≥a textarea
                pasteJsonTextarea.value = '';
                
                // Hi·ªÉn th·ªã th√¥ng b√°o
                showAlert(injectAlert, 'success', `ƒê√£ th√™m JSON #${pastedJsonData.length} v·ªõi ${Object.keys(parsedJson).length} c·∫∑p key-value.`);
                
            } catch (e) {
                showAlert(injectAlert, 'danger', 'JSON kh√¥ng h·ª£p l·ªá: ' + e.message);
            }
        });
        
        // C·∫≠p nh·∫≠t hi·ªÉn th·ªã danh s√°ch JSON ƒë√£ paste
        function updatePastedJsonList() {
            if (pastedJsonData.length === 0) {
                pastedJsonList.style.display = 'none';
                return;
            }
            
            pastedJsonList.style.display = 'block';
            pastedJsonItems.innerHTML = '';
            
            pastedJsonData.forEach((jsonObj, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'mb-1 d-flex justify-content-between align-items-center';
                itemDiv.innerHTML = `
                    <div>
                        <i class="fas fa-clipboard text-success"></i> 
                        <small><strong>JSON #${index + 1}</strong> - ${Object.keys(jsonObj).length} keys</small>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="removePastedJson(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                pastedJsonItems.appendChild(itemDiv);
            });
        }
        
        // X√≥a m·ªôt JSON ƒë√£ paste
        window.removePastedJson = function(index) {
            pastedJsonData.splice(index, 1);
            updatePastedJsonList();
            showAlert(injectAlert, 'info', 'ƒê√£ x√≥a JSON.');
        };
        
        // X√≥a t·∫•t c·∫£ JSON ƒë√£ paste
        clearPastedJsonBtn.addEventListener('click', function() {
            if (confirm('X√≥a t·∫•t c·∫£ JSON ƒë√£ paste?')) {
                pastedJsonData = [];
                updatePastedJsonList();
                showAlert(injectAlert, 'info', 'ƒê√£ x√≥a t·∫•t c·∫£ JSON ƒë√£ paste.');
            }
        });
        
        // X·ª≠ l√Ω khi ch·ªçn file JSON (nhi·ªÅu file)
        injectJsonFile.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                const fileList = document.getElementById('injectJsonFileList');
                fileList.innerHTML = '';
                
                // Hi·ªÉn th·ªã danh s√°ch c√°c file
                Array.from(e.target.files).forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'mb-1';
                    const icon = file.name.endsWith('.zip') ? 'fa-file-archive' : 'fa-file-code';
                    const color = file.name.endsWith('.zip') ? 'text-warning' : 'text-primary';
                    fileItem.innerHTML = `<i class="fas ${icon} ${color}"></i> <small>${file.name}</small>`;
                    fileList.appendChild(fileItem);
                });
                
                injectJsonFileInfo.style.display = 'block';
            }
        });
        
        // X·ª≠ l√Ω x√≥a file JSON
        injectJsonFileRemove.addEventListener('click', function() {
            injectJsonFile.value = '';
            injectJsonFileInfo.style.display = 'none';
        });
        
        // X·ª≠ l√Ω drag and drop cho JSON files
        const injectJsonUploadArea = document.getElementById('injectJsonUploadArea');
        
        injectJsonUploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            injectJsonUploadArea.style.borderColor = '#764ba2';
            injectJsonUploadArea.style.background = '#e9ecef';
        });
        
        injectJsonUploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            injectJsonUploadArea.style.borderColor = '#667eea';
            injectJsonUploadArea.style.background = '#f8f9fa';
        });
        
        injectJsonUploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            injectJsonUploadArea.style.borderColor = '#667eea';
            injectJsonUploadArea.style.background = '#f8f9fa';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                // S·ª≠ d·ª•ng DataTransfer ƒë·ªÉ g√°n files v√†o input
                const dataTransfer = new DataTransfer();
                Array.from(files).forEach(file => {
                    // Ch·ªâ ch·∫•p nh·∫≠n file .json ho·∫∑c .zip
                    if (file.name.endsWith('.json') || file.name.endsWith('.zip')) {
                        dataTransfer.items.add(file);
                    }
                });
                
                if (dataTransfer.files.length > 0) {
                    injectJsonFile.files = dataTransfer.files;
                    
                    // Hi·ªÉn th·ªã danh s√°ch files
                    const fileList = document.getElementById('injectJsonFileList');
                    fileList.innerHTML = '';
                    
                    Array.from(dataTransfer.files).forEach((file, index) => {
                        const fileItem = document.createElement('div');
                        fileItem.className = 'mb-1';
                        const icon = file.name.endsWith('.zip') ? 'fa-file-archive' : 'fa-file-code';
                        const color = file.name.endsWith('.zip') ? 'text-warning' : 'text-primary';
                        fileItem.innerHTML = `<i class="fas ${icon} ${color}"></i> <small>${file.name}</small>`;
                        fileList.appendChild(fileItem);
                    });
                    
                    injectJsonFileInfo.style.display = 'block';
                } else {
                    showAlert(injectAlert, 'warning', 'Ch·ªâ ch·∫•p nh·∫≠n file .json ho·∫∑c .zip!');
                }
            }
        });
        
        // X·ª≠ l√Ω submit form Inject
        injectForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Ki·ªÉm tra xem c√≥ file ƒë∆∞·ª£c upload ch∆∞a
            if (!uploadedExcelFilename || mainExcelFile.files.length === 0) {
                showAlert(injectAlert, 'warning', 'Vui l√≤ng upload file (Excel ho·∫∑c PowerPoint) ·ªü B∆∞·ªõc 1 tr∆∞·ªõc!');
                return;
            }
            
            // Ki·ªÉm tra xem c√≥ file JSON HO·∫∂C pasted JSON kh√¥ng
            if (injectJsonFile.files.length === 0 && pastedJsonData.length === 0) {
                showAlert(injectAlert, 'warning', 'Vui l√≤ng ch·ªçn file JSON ƒë√£ d·ªãch ho·∫∑c paste JSON!');
                return;
            }
            
            // Hi·ªÉn th·ªã loading
            injectLoading.style.display = 'block';
            injectAlert.innerHTML = '';
            
            // T·∫°o FormData v·ªõi file Excel t·ª´ upload chung v√† t·∫•t c·∫£ file JSON
            const formData = new FormData();
            formData.append('excel_file', mainExcelFile.files[0]);
            
            // Th√™m t·∫•t c·∫£ c√°c file JSON/ZIP
            Array.from(injectJsonFile.files).forEach(file => {
                formData.append('json_files', file);
            });
            
            // Th√™m t·∫•t c·∫£ JSON ƒë√£ paste (g·ª≠i d∆∞·ªõi d·∫°ng JSON string)
            if (pastedJsonData.length > 0) {
                formData.append('pasted_json_data', JSON.stringify(pastedJsonData));
            }
            
            try {
                // G·ª≠i request
                const response = await fetch('/inject', {
                    method: 'POST',
                    body: formData
                });
                
                // ·∫®n loading
                injectLoading.style.display = 'none';
                
                if (response.ok) {
                    // L·∫•y t√™n file t·ª´ header Content-Disposition
                    const disposition = response.headers.get('Content-Disposition');
                    let filename = `output_translated_${Date.now()}.xlsx`;
                    const parsedFilename = parseDownloadFilename(disposition);
                    if (parsedFilename) {
                        filename = parsedFilename;
                    }
                    
                    // T·∫£i file v·ªõi t√™n ƒë√∫ng extension
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    showAlert(injectAlert, 'success', 'N·∫°p b·∫£n d·ªãch th√†nh c√¥ng! File ƒëang ƒë∆∞·ª£c t·∫£i v·ªÅ. T·∫•t c·∫£ file t·∫°m ƒë√£ ƒë∆∞·ª£c x√≥a.');
                    
                    // Reset form JSON
                    injectJsonFile.value = '';
                    injectJsonFileInfo.style.display = 'none';
                    
                    // Reset pasted JSON
                    pastedJsonData = [];
                    updatePastedJsonList();
                    pasteJsonTextarea.value = '';
                    
                    // T·ª± ƒë·ªông x√≥a t·∫•t c·∫£ file trong th∆∞ m·ª•c uploads sau khi th√†nh c√¥ng
                    await clearUploads(true);
                } else {
                    // Ki·ªÉm tra xem response c√≥ ph·∫£i JSON kh√¥ng
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        const error = await response.json();
                        showAlert(injectAlert, 'danger', error.error || 'C√≥ l·ªói x·∫£y ra!');
                    } else {
                        // N·∫øu kh√¥ng ph·∫£i JSON (c√≥ th·ªÉ l√† HTML t·ª´ trang login ho·∫∑c l·ªói server)
                        const text = await response.text();
                        if (text.includes('<html') || text.includes('<!DOCTYPE')) {
                            showAlert(injectAlert, 'danger', 'Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n. Vui l√≤ng <a href="/login">ƒëƒÉng nh·∫≠p l·∫°i</a>.');
                        } else {
                            showAlert(injectAlert, 'danger', 'L·ªói: ' + (text || 'Kh√¥ng x√°c ƒë·ªãnh'));
                        }
                    }
                }
            } catch (error) {
                injectLoading.style.display = 'none';
                showAlert(injectAlert, 'danger', 'L·ªói k·∫øt n·ªëi: ' + error.message);
            }
        });
        
        // ==================== H√ÄM TR·ª¢ GI√öP ====================

        function parseDownloadFilename(contentDisposition) {
            if (!contentDisposition) return null;

            // ∆Øu ti√™n RFC 5987: filename*=UTF-8''...
            const filenameStarMatch = contentDisposition.match(/filename\*\s*=\s*UTF-8''([^;\n]+)/i);
            if (filenameStarMatch && filenameStarMatch[1]) {
                try {
                    return decodeURIComponent(filenameStarMatch[1].trim());
                } catch (e) {
                    // fallback xu·ªëng filename th∆∞·ªùng
                }
            }

            // Fallback: filename="..." ho·∫∑c filename=...
            const filenameMatch = contentDisposition.match(/filename\s*=\s*(("([^"]+)")|([^;\n]+))/i);
            if (filenameMatch) {
                return (filenameMatch[3] || filenameMatch[4] || '').trim();
            }

            return null;
        }
        
        // H√†m x√≥a t·∫•t c·∫£ file trong uploads
        async function clearUploads(skipConfirm = false) {
            // X√°c nh·∫≠n tr∆∞·ªõc khi x√≥a (tr·ª´ khi skipConfirm = true)
            if (!skipConfirm && !confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a T·∫§T C·∫¢ file trong th∆∞ m·ª•c uploads?\n\nThao t√°c n√†y kh√¥ng th·ªÉ ho√†n t√°c!')) {
                return;
            }
            
            try {
                const response = await fetch('/clear-uploads', {
                    method: 'POST'
                });
                
                // Ki·ªÉm tra xem response c√≥ ph·∫£i JSON kh√¥ng
                const contentType = response.headers.get('content-type');
                let result;
                
                if (contentType && contentType.includes('application/json')) {
                    result = await response.json();
                } else {
                    const text = await response.text();
                    if (text.includes('<html') || text.includes('<!DOCTYPE')) {
                        if (!skipConfirm) {
                            alert('‚ùå Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
                            window.location.href = '/login';
                        }
                        return;
                    }
                    result = { error: text };
                }
                
                if (response.ok && result.success) {
                    if (!skipConfirm) {
                        alert(`‚úÖ ${result.message}`);
                    }
                    
                    // Reset form v√† tr·∫°ng th√°i
                    mainExcelFile.value = '';
                    mainFileInfo.style.display = 'none';
                    uploadedExcelFilename = null;
                    extractBtn.disabled = true;
                    injectBtn.disabled = true;
                    mainAlert.innerHTML = '';
                    injectJsonFile.value = '';
                    injectJsonFileInfo.style.display = 'none';
                } else {
                    if (!skipConfirm) {
                        alert('‚ùå L·ªói: ' + (result.error || result.message));
                    }
                }
            } catch (error) {
                if (!skipConfirm) {
                    alert('‚ùå L·ªói k·∫øt n·ªëi: ' + error.message);
                }
            }
        }
        
        // H√†m copy prompt AI
        // copyPrompt() ƒë√£ ƒë∆∞·ª£c thay th·∫ø b·ªüi renderJsonFileRows() inline copy
        
        function showAlert(element, type, message) {
            element.innerHTML = `
                <div class="alert alert-${type} alert-custom alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'times-circle'}"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
        }
    </script>
</body>
</html>
